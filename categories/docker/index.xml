<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>docker - 分类 - 打工人日志 - jobcher</title>
        <link>https://www.jobcher.com/categories/docker/</link>
        <description>docker - 分类 - 打工人日志 - jobcher</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>nb@nbtyfood.com (jobcher)</managingEditor>
            <webMaster>nb@nbtyfood.com (jobcher)</webMaster><lastBuildDate>Mon, 19 Sep 2022 00:00:00 &#43;0000</lastBuildDate><atom:link href="https://www.jobcher.com/categories/docker/" rel="self" type="application/rss+xml" /><item>
    <title>清理Docker容器日志</title>
    <link>https://www.jobcher.com/cleandocker/</link>
    <pubDate>Mon, 19 Sep 2022 00:00:00 &#43;0000</pubDate>
    <author>作者</author>
    <guid>https://www.jobcher.com/cleandocker/</guid>
    <description><![CDATA[<h1 id="清理-docker-容器日志">清理 Docker 容器日志</h1>
<p>如果 docker 容器正在运行，那么使用<code>rm -rf</code>方式删除日志后，通过<code>df -h</code>会发现磁盘空间并没有释放。原因是在 Linux 或者 Unix 系统中，通过<code>rm -rf</code>或者文件管理器删除文件，将会从文件系统的目录结构上解除链接（unlink）。如果文件是被打开的（有一个进程正在使用），那么进程将仍然可以读取该文件，磁盘空间也一直被占用。正确姿势是<code>cat /dev/null &gt; *-json.log</code>，当然你也可以通过<code>rm -rf</code>删除后重启 docker。</p>
<h2 id="日志清理脚本-clean_docker_logsh">日志清理脚本 clean_docker_log.sh</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;======== start clean docker containers logs ========&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">logs</span><span class="o">=</span><span class="k">$(</span>find /var/lib/docker/containers/ -name *-json.log<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> log in <span class="nv">$logs</span>
</span></span><span class="line"><span class="cl">        <span class="k">do</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span> <span class="s2">&#34;clean logs : </span><span class="nv">$log</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                cat /dev/null &gt; <span class="nv">$log</span>
</span></span><span class="line"><span class="cl">        <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;======== end clean docker containers logs ========&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>chmod +x clean_docker_log.sh &amp;&amp; ./clean_docker_log.sh</p>
</blockquote>
<h2 id="设置-docker-容器日志大小">设置 Docker 容器日志大小</h2>
<p>设置一个容器服务的日志大小上限<br>
上述方法，日志文件迟早又会涨回来。要从根本上解决问题，需要限制容器服务的日志大小上限。这个通过配置容器<code>docker-compose</code>的<code>max-size</code>选项来实现</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">nginx</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.12.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l">“json-file”</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="l">“5g”</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="全局设置">全局设置</h3>
<p>新建<code>/etc/docker/daemon.json</code>，若有就不用新建了。添加<code>log-dirver</code>和<code>log-opts</code>参数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">#</span> <span class="err">vim</span> <span class="err">/etc/docker/daemon.json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;log-driver&#34;</span><span class="p">:</span><span class="s2">&#34;json-file&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;log-opts&#34;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&#34;max-size&#34;</span><span class="p">:</span><span class="s2">&#34;500m&#34;</span><span class="p">,</span> <span class="nt">&#34;max-file&#34;</span><span class="p">:</span><span class="s2">&#34;3&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>max-size=500m</code>，意味着一个容器日志大小上限是<code>500M</code><br>
<code>max-file=3</code>，意味着一个容器有三个日志，分别是<code>id+.json</code>、<code>id+1.json</code>、<code>id+2.json</code>。</p>
<blockquote>
<p>注意：设置的日志大小，只对新建的容器有效。</p>
</blockquote>
]]></description>
</item><item>
    <title>contained 安装及使用</title>
    <link>https://www.jobcher.com/contained/</link>
    <pubDate>Wed, 17 Aug 2022 00:00:00 &#43;0000</pubDate>
    <author>作者</author>
    <guid>https://www.jobcher.com/contained/</guid>
    <description><![CDATA[<h1 id="contained-安装及使用">contained 安装及使用</h1>
<p><br>
containerd 是一个行业标准的容器运行时，强调简单性、健壮性和可移植性。它可作为 Linux 和 Windows 的守护进程使用，可以管理其主机系统的完整容器生命周期：图像传输和存储、容器执行和监督、低级存储和网络附件等。<br>
<code>containerd</code> is a member of <code>CNCF</code> with <code>graduated</code> status.</p>
<ol>
<li>早在 2016 年 3 月，<code>Docker 1.11</code>的<code>Docker Engine</code>里就包含了<code>containerd</code>，而现在则是把<code>containerd</code>从<code>Docker Engine</code>里彻底剥离出来，作为一个独立的开源项目独立发展，目标是提供一个更加开放、稳定的容器运行基础设施。和原先包含在 Docker Engine 里<code>containerd</code>相比，独立的<code>containerd</code>将具有更多的功能，可以涵盖整个容器运行时管理的所有需求。</li>
<li><code>containerd</code>并不是直接面向最终用户的，而是主要用于集成到更上层的系统里，比如<code>Swarm</code>, <code>Kubernetes</code>, <code>Mesos</code>等容器编排系统。</li>
<li><code>containerd</code>以<code>Daemon</code>的形式运行在系统上，通过暴露底层的<code>gRPC API</code>，上层系统可以通过这些<code>API</code>管理机器上的容器。</li>
<li>每个<code>containerd</code>只负责<code>一台机器</code>，Pull 镜像，对容器的操作（启动、停止等），网络，存储都是由 containerd 完成。具体运行容器由<code>runC</code>负责，实际上只要是符合<code>OCI规范</code>的容器都可以支持。</li>
<li>对于容器编排服务来说，运行时只需要使用<code>containerd+runC</code>，更加轻量，容易管理。 5.独立之后<code>containerd</code>的特性演进可以和<code>Docker Engine</code>分开，专注容器运行时管理，可以更稳定。</li>
</ol>
<h2 id="安装">安装</h2>
<p>centos</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">yum install -y containerd.io
</span></span></code></pre></td></tr></table>
</div>
</div><p>ubuntu</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apt install -y containerd.io
</span></span></code></pre></td></tr></table>
</div>
</div><p>设置开机自启</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">systemctl <span class="nb">enable</span> containerd
</span></span><span class="line"><span class="cl">systemctl start containerd
</span></span><span class="line"><span class="cl">systemctl status containerd
</span></span></code></pre></td></tr></table>
</div>
</div><p>验证</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ctr version
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ctr-命令">ctr 命令</h2>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">plugins, plugin</td>
<td style="text-align:left">提供有关容器插件的信息</td>
</tr>
<tr>
<td style="text-align:left">version</td>
<td style="text-align:left">打印客户端和服务器版本</td>
</tr>
<tr>
<td style="text-align:left">containers, c, container</td>
<td style="text-align:left">管理容器</td>
</tr>
<tr>
<td style="text-align:left">content</td>
<td style="text-align:left">管理内容</td>
</tr>
<tr>
<td style="text-align:left">events, event</td>
<td style="text-align:left">显示容器事件</td>
</tr>
<tr>
<td style="text-align:left">images, image, i</td>
<td style="text-align:left">管理图像</td>
</tr>
<tr>
<td style="text-align:left">leases</td>
<td style="text-align:left">管理租约</td>
</tr>
<tr>
<td style="text-align:left">namespaces, namespace, ns</td>
<td style="text-align:left">管理租命名空间</td>
</tr>
<tr>
<td style="text-align:left">pprof</td>
<td style="text-align:left">为 containerd 提供 golang pprof 输出</td>
</tr>
<tr>
<td style="text-align:left">run</td>
<td style="text-align:left">运行一个容器</td>
</tr>
<tr>
<td style="text-align:left">snapshots, snapshot</td>
<td style="text-align:left">管理快照</td>
</tr>
<tr>
<td style="text-align:left">tasks, t, task</td>
<td style="text-align:left">管理任务</td>
</tr>
<tr>
<td style="text-align:left">install</td>
<td style="text-align:left">安装一个新包</td>
</tr>
<tr>
<td style="text-align:left">oci</td>
<td style="text-align:left">OCI 工具</td>
</tr>
<tr>
<td style="text-align:left">shim</td>
<td style="text-align:left">直接与 shim 交互</td>
</tr>
<tr>
<td style="text-align:left">help, h</td>
<td style="text-align:left">显示命令列表或一个命令的帮助</td>
</tr>
</tbody>
</table>
]]></description>
</item><item>
    <title>docker 命令(2)</title>
    <link>https://www.jobcher.com/docker02/</link>
    <pubDate>Fri, 18 Feb 2022 00:00:00 &#43;0000</pubDate>
    <author>作者</author>
    <guid>https://www.jobcher.com/docker02/</guid>
    <description><![CDATA[<h1 id="docker-命令2">docker 命令(2)</h1>
<h2 id="docker-ps-命令"><code>docker ps</code> 命令</h2>
<p><code>docker ps</code> 能查看所有运行中的容器<br>
<code>docker ps -a</code> 能查看所有的容器<br>
<code>docker rm -f $(docker ps -aq)</code> 强制删除所有容器</p>
<h2 id="docker-run和docker-create有什么区别"><code>docker run</code>和<code>docker create</code>有什么区别</h2>
<p><code>docker create</code>命令能够基于镜像创建容器。<br>
该命令执行的效果类似于<code>docker run -d</code>，即创建一个将在系统后台运行的容器。<br>
但是与<code>docker run -d</code>不同的是，<code>docker create</code>创建的容器<code>并未实际启动</code>，还需要执行<code>docker start</code>命令或<code>docker run</code>命令以启动容器。<br>
事实上，<code>docker creat</code>e 命令常用于<code>在启动容器之前进行必要的设置</code>。</p>
]]></description>
</item><item>
    <title>清理Docker的container，image与volume</title>
    <link>https://www.jobcher.com/docker-clean/</link>
    <pubDate>Thu, 10 Feb 2022 00:00:00 &#43;0000</pubDate>
    <author>作者</author>
    <guid>https://www.jobcher.com/docker-clean/</guid>
    <description><![CDATA[<h1 id="清理-docker-的-containerimage-与-volume">清理 Docker 的 container，image 与 volume</h1>
<p>Docker 的镜像（image）、容器（container）、数据卷（volume）， 都是由 daemon 托管的。 因此，在需要清理时，也需要使用其自带的手段。</p>
<h2 id="清理技巧">清理技巧</h2>
<p>清理所有停止运行的容器：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker container prune
</span></span><span class="line"><span class="cl"><span class="c1"># or</span>
</span></span><span class="line"><span class="cl">docker rm <span class="k">$(</span>docker ps -aq<span class="k">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>清理所有悬挂<code>（&lt;none&gt;）</code>镜像：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker image prune
</span></span><span class="line"><span class="cl"><span class="c1"># or</span>
</span></span><span class="line"><span class="cl">docker rmi <span class="k">$(</span>docker images -qf <span class="s2">&#34;dangling=true&#34;</span><span class="k">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>清理所有无用数据卷：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker volume prune
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于<code>prune</code>操作是批量删除类的危险操作，所以会有一次确认。 如果不想输入<code>y&lt;CR&gt;</code>来确认，可以添加<code>-f</code>操作。慎用！</p>
<h2 id="清理停止的容器">清理停止的容器</h2>
<p>docker rm -lv CONTAINER
<code>-l</code>是清理 link，<code>v</code>是清理 volume。 这里的 CONTAINER 是容器的 name 或 ID，可以是一个或多个。</p>
<p>参数列表：</p>
<table>
<thead>
<tr>
<th style="text-align:left">Name shorthand</th>
<th style="text-align:left">Default</th>
<th style="text-align:left">Description</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">–force,-f</td>
<td style="text-align:left">false</td>
<td style="text-align:left">Force the removal of a running container (uses SIGKILL)</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">–link, -l</td>
<td style="text-align:left">false</td>
<td style="text-align:left">Remove the specified link</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">–volumes, -v</td>
<td style="text-align:left"></td>
<td style="text-align:left">false</td>
<td>Remove the volumes associated with the container</td>
</tr>
</tbody>
</table>
<h2 id="清理所有停止的容器">清理所有停止的容器</h2>
<p>通过<code>docker ps</code>可以查询当前运行的容器信息。 而通过<code>docker ps -a</code>，可以查询所有的容器信息，包括已停止的。</p>
<p>在需要清理所有已停止的容器时，通常利用 shell 的特性，组合一下就好。</p>
<p>docker rm $(docker ps -aq)
其中，<code>ps的-q</code>，是只输出容器 ID，方便作为参数让<code>rm</code>使用。 假如给<code>rm</code>指定<code>-f</code>，则可以清理所有容器，包括正在运行的。</p>
<p>这条组合命令，等价于另一条命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker container prune
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>container</code>子命令，下面包含了所有和容器相关的子命令。 包括<code>docker ps</code>，等价于<code>docker container ps</code>或<code>docker container ls</code>。 其余还有<code>start、stop、kill、cp</code>等，一级子命令相当于二级子命令在外面的 alias。 而<code>prune</code>则是特别提供的清理命令，这在其它的管理命令里还可以看到，比如<code>image、volume</code>。</p>
<h2 id="按需批量清理容器">按需批量清理容器</h2>
<p>清除所有已停止的容器，是比较常用的清理。 但有时会需要做一些特殊过滤。</p>
<p>这时就需要使用<code>docker ps --filter</code>。</p>
<p>比如，显示所有返回值为 0，即正常退出的容器：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker ps -a --filter <span class="s1">&#39;exited=0&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>同理，可以得到其它非正常退出的容器。</p>
<p>目前支持的过滤器有：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">id (container’s id)
</span></span><span class="line"><span class="cl">label (label=&lt;key&gt; or label=&lt;key&gt;=&lt;value&gt;)
</span></span><span class="line"><span class="cl">name (container’s name)
</span></span><span class="line"><span class="cl">exited (int - the code of exited containers. Only useful with –all)
</span></span><span class="line"><span class="cl">status (created|restarting|running|removing|paused|exited|dead)
</span></span><span class="line"><span class="cl">ancestor (&lt;image-name&gt;[:&lt;tag&gt;], &lt;image id&gt; or &lt;image@digest&gt;) - filters containers that were created from the given image or a descendant.
</span></span><span class="line"><span class="cl">before (container’s id or name) - filters containers created before given id or name
</span></span><span class="line"><span class="cl">since (container’s id or name) - filters containers created since given id or name
</span></span><span class="line"><span class="cl">isolation (default|process|hyperv) (Windows daemon only)
</span></span><span class="line"><span class="cl">volume (volume name or mount point) - filters containers that mount volumes.
</span></span><span class="line"><span class="cl">network (network id or name) - filters containers connected to the provided network
</span></span><span class="line"><span class="cl">health (starting|healthy|unhealthy|none) - filters containers based on healthcheck status
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="清理失败">清理失败</h2>
<p>如果在清理容器时发生失败，通过重启 Docker 的 Daemon，应该都能解决问题。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># systemd</span>
</span></span><span class="line"><span class="cl">sudo systemctl restart docker.service
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># initd</span>
</span></span><span class="line"><span class="cl">sudo service docker restart
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="清理镜像">清理镜像</h2>
<p>与清理容器的<code>ps、rm</code>类似，清理镜像也有<code>images、rmi</code>两个子命令。 <code>images</code>用来查看，<code>rmi</code>用来删除。</p>
<p>清理镜像前，应该确保该镜像的容器，已经被清除。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker rmi IMAGE
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中，IMAGE 可以是 name 或 ID。 如果是 name，不加 TAG 可以删除所有 TAG。</p>
<p>另外，这两个命令也都属于 alias。 <code>docker images</code>等价<code>于docker image ls</code>，而<code>docker rmi</code>等价于<code>docker image rm</code>。</p>
<p>按需批量清理镜像 ¶
与<code>ps</code>类似，<code>images</code>也支持<code>--filter</code>参数。</p>
<p>与清理相关，最常用的，当属<code>&lt;none&gt;</code>了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker images --filter <span class="s2">&#34;dangling=true&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这条命令，可以列出所有悬挂（dangling）的镜像，也就是显示为<none>的那些。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker rmi <span class="k">$(</span>docker images -qf <span class="s2">&#34;dangling=true&#34;</span><span class="k">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这条组合命令，如果不写入 Bash 的 alias，几乎无法使用。 不过还有一条等价命令，非常容易使用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker image prune
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>prune</code>和<code>images</code>类似，也同样支持&ndash;filter 参数。 其它的<code>filter</code>有：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">dangling (boolean - true or false)
</span></span><span class="line"><span class="cl">label (label=&lt;key&gt; or label=&lt;key&gt;=&lt;value&gt;)
</span></span><span class="line"><span class="cl">before (&lt;image-name&gt;[:&lt;tag&gt;], &lt;image id&gt; or &lt;image@digest&gt;) - filter images created before given id or references
</span></span><span class="line"><span class="cl">since (&lt;image-name&gt;[:&lt;tag&gt;], &lt;image id&gt; or &lt;image@digest&gt;) - filter images created since given id or references
</span></span><span class="line"><span class="cl">reference (pattern of an image reference) - filter images whose reference matches the specified pattern
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="清理所有无用镜像">清理所有无用镜像</h2>
<p>这招要慎用，否则需要重新下载。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker image prune -a
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="清理数据卷">清理数据卷</h2>
<p>数据卷不如容器或镜像那样显眼，但占的硬盘却可大可小。</p>
<p>数据卷的相关命令，都在<code>docker volume</code>中了。</p>
<p>一般用<code>docker volume ls</code>来查看，用<code>docker volume rm VOLUME</code>来删除一个或多个。</p>
<p>不过，绝大多数情况下，不需要执行这两个命令的组合。 直接执行<code>docker volume prune</code>就好，即可删除所有无用卷。</p>
<p>注意：这是一个危险操作！甚至可以说，这是本文中最危险的操作！ 一般真正有价值的运行数据，都在数据卷中。 （当然也可能挂载到了容器外的文件系统里，那就没关系。） 如果在关键服务停止期间，执行这个操作，很可能会丢失所有数据！</p>
<h2 id="从文件系统删除">从文件系统删除</h2>
<p>除配置文件以为，Docker 的内容相关文件，基本都放在<code>/var/lib/docker/</code>目录下。</p>
<p>该目录下有下列子目录，基本可以猜测出用途：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">aufs
</span></span><span class="line"><span class="cl">containers
</span></span><span class="line"><span class="cl">image
</span></span><span class="line"><span class="cl">network
</span></span><span class="line"><span class="cl">plugins
</span></span><span class="line"><span class="cl">swarm
</span></span><span class="line"><span class="cl">tmp
</span></span><span class="line"><span class="cl">trust
</span></span><span class="line"><span class="cl">volumes
</span></span></code></pre></td></tr></table>
</div>
</div><p>一般不推荐直接操作这些目录，除非一些极特殊情况。 操作不当，后果难料，需要慎重。</p>
]]></description>
</item><item>
    <title>docker 命令</title>
    <link>https://www.jobcher.com/docker/</link>
    <pubDate>Tue, 28 Dec 2021 00:00:00 &#43;0000</pubDate>
    <author>作者</author>
    <guid>https://www.jobcher.com/docker/</guid>
    <description><![CDATA[<h1 id="安装-docker">安装 docker</h1>
<p>通过 docker 脚本安装</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">    curl -fsSL https://get.docker.com <span class="p">|</span> bash -s docker --mirror Aliyun
</span></span><span class="line"><span class="cl">    curl -sSL https://get.daocloud.io/docker <span class="p">|</span> sh
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="docker-compose-安装">docker-compose 安装</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1">#下载安装</span>
</span></span><span class="line"><span class="cl">sudo curl -L <span class="s2">&#34;https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-</span><span class="k">$(</span>uname -s<span class="k">)</span><span class="s2">-</span><span class="k">$(</span>uname -m<span class="k">)</span><span class="s2">&#34;</span> -o /usr/local/bin/docker-compose
</span></span><span class="line"><span class="cl"><span class="c1">#可执行权限</span>
</span></span><span class="line"><span class="cl">sudo chmod +x /usr/local/bin/docker-compose
</span></span><span class="line"><span class="cl"><span class="c1">#创建软链：</span>
</span></span><span class="line"><span class="cl">sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
</span></span><span class="line"><span class="cl"><span class="c1">#测试是否安装成功</span>
</span></span><span class="line"><span class="cl">docker-compose --version
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="docker-命令">docker 命令</h2>
<p>常用 docker 命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">    <span class="c1">#查看容器</span>
</span></span><span class="line"><span class="cl">    docker ps
</span></span><span class="line"><span class="cl">    <span class="c1">#查看镜像</span>
</span></span><span class="line"><span class="cl">    docker images
</span></span><span class="line"><span class="cl">    <span class="c1">#停止当前所有容器</span>
</span></span><span class="line"><span class="cl">    docker stop <span class="k">$(</span>docker ps -aq<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#删除当前停止的所有容器</span>
</span></span><span class="line"><span class="cl">    docker rm <span class="k">$(</span>docker ps -aq<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#删除镜像</span>
</span></span><span class="line"><span class="cl">    docker rmi nginx
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description>
</item><item>
    <title>docker 安装kong 网关</title>
    <link>https://www.jobcher.com/docker-kong/</link>
    <pubDate>Wed, 22 Dec 2021 00:00:00 &#43;0000</pubDate>
    <author>作者</author>
    <guid>https://www.jobcher.com/docker-kong/</guid>
    <description><![CDATA[<h1 id="docker-安装-kong-网关">docker 安装 kong 网关</h1>
<h2 id="建立数据库">建立数据库</h2>
<ol>
<li>创建网络</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker network create kong-net
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>建立数据库</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker run -d --name kong-database <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --network<span class="o">=</span>kong-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -p 5432:5432 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;POSTGRES_USER=kong&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;POSTGRES_DB=kong&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;POSTGRES_PASSWORD=kong123&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  postgres:9.6
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>创建 kong 数据</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker run --rm --network<span class="o">=</span>kong-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_DATABASE=postgres&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_PG_HOST=kong-database&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_PG_PASSWORD=kong123&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_PASSWORD=kong123&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  kong:latest kong migrations bootstrap
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="创建-kong">创建 kong</h2>
<ol>
<li>创建 kong gateway</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">  docker run -d --name kong <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --network<span class="o">=</span>kong-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_DATABASE=postgres&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_PG_HOST=kong-database&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_PG_USER=kong&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_PG_PASSWORD=kong123&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_CASSANDRA_CONTACT_POINTS=kong-database&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_PROXY_ACCESS_LOG=/dev/stdout&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_ADMIN_ACCESS_LOG=/dev/stdout&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_PROXY_ERROR_LOG=/dev/stderr&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_ADMIN_ERROR_LOG=/dev/stderr&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -e <span class="s2">&#34;KONG_ADMIN_LISTEN=0.0.0.0:8001, 0.0.0.0:8444 ssl&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -p 8000:8000 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -p 8443:8443 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -p 127.0.0.1:8001:8001 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -p 127.0.0.1:8444:8444 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  kong:latest
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="安装-konga">安装 konga</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker pull pantsel/konga:latest
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker run --rm pantsel/konga:latest <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        -c prepare <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        -a postgres <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        -u postgresql://kong:kong123@172.18.0.1:5432/konga
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker run -d -p 1337:1337 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        --network kong-net <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        --name konga <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        -e <span class="s2">&#34;NODE_ENV=production&#34;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        -e <span class="s2">&#34;DB_ADAPTER=postgres&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        -e <span class="s2">&#34;DB_URI=postgresql://kong:kong123@172.18.0.1:5432/konga&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        pantsel/konga
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description>
</item><item>
    <title>搭建docker registry 镜像仓库</title>
    <link>https://www.jobcher.com/docker-registry/</link>
    <pubDate>Wed, 22 Dec 2021 00:00:00 &#43;0000</pubDate>
    <author>作者</author>
    <guid>https://www.jobcher.com/docker-registry/</guid>
    <description><![CDATA[<h1 id="搭建-docker-registry-镜像仓库">搭建 docker registry 镜像仓库</h1>
<h2 id="获取镜像">获取镜像</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker pull registry:2.7.1
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker pull hyper/docker-registry-web
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="容器运行">容器运行</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mkdir -p /opt/data/registry
</span></span><span class="line"><span class="cl">docker run -d -p 5000:5000 -v /opt/data/registry:/var/lib/registry --name registry registry:2.7.1
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker run -d -p 8080:8080 --name registry-web --link registry <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -e <span class="nv">REGISTRY_URL</span><span class="o">=</span>http://192.168.99.146:5000/v2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -e <span class="nv">REGISTRY_TRUST_ANY_SSL</span><span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -e <span class="nv">REGISTRY_BASIC_AUTH</span><span class="o">=</span><span class="s2">&#34;GjhYGDGi2HhkJB&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -e <span class="nv">REGISTRY_NAME</span><span class="o">=</span>192.168.99.146:5000 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   hyper/docker-registry-web
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="上传容器">上传容器</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">vim /etc/docker/daemon.json
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;insecure-registries&#34;</span>: <span class="o">[</span><span class="s2">&#34;192.168.99.146:5000&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker tag sjtfreaks/hogo-nginx:v1.1 192.168.99.146:5000/sjtfreaks/hogo-nginx:v1.1
</span></span><span class="line"><span class="cl">docker push 192.168.99.146:5000/sjtfreaks/hogo-nginx:v1.1
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description>
</item><item>
    <title>docker image镜像上传</title>
    <link>https://www.jobcher.com/dockerimage/</link>
    <pubDate>Thu, 09 Dec 2021 00:00:00 &#43;0000</pubDate>
    <author>作者</author>
    <guid>https://www.jobcher.com/dockerimage/</guid>
    <description><![CDATA[<h1 id="docker-image-镜像上传">docker image 镜像上传</h1>
<p>登入 docker hub，在https://hub.docker.com上注册你的账号。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker login
</span></span><span class="line"><span class="cl">username：#输入你的用户名
</span></span><span class="line"><span class="cl">password：#输入你的密码
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="上传镜像">上传镜像</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker tag nginx:hugo sjtfreaks/hogo-nginx:v1
</span></span><span class="line"><span class="cl">docker push sjtfreaks/hogo-nginx:v1
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description>
</item><item>
    <title>docker进阶使用</title>
    <link>https://www.jobcher.com/docker01/</link>
    <pubDate>Thu, 09 Dec 2021 00:00:00 &#43;0000</pubDate>
    <author>作者</author>
    <guid>https://www.jobcher.com/docker01/</guid>
    <description><![CDATA[<h1 id="docker-进阶使用">docker 进阶使用</h1>
<p>dockerfile 和 docker compose 的配置</p>
<h1 id="dockerfile-使用">Dockerfile 使用</h1>
<p>Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。</p>
<p>例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">    FROM nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    RUN <span class="nb">echo</span> <span class="s1">&#39;这是一个本地构建的nginx镜像&#39;</span> &gt; /usr/share/nginx/html/index.html<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>保存 Dockerfile 文件并在本地路径执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">    docker build -t nginx:v1-test .
</span></span><span class="line"><span class="cl">    docker run -name docker run --name nginx-test -d  -p 8080:80 nginx:v1-test
</span></span></code></pre></td></tr></table>
</div>
</div><p>浏览 nginx 页面确认更新内容</p>
<pre><code>curl 127.0.0.1:8080
输出：
这是一个本地构建的nginx镜像
</code></pre>
<h2 id="docker-命令详解">Docker 命令详解</h2>
<h3 id="copy">COPY</h3>
<p>复制指令，从上下文目录中复制文件或者目录到容器里指定路径。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">    COPY <span class="o">[</span>--chown<span class="o">=</span>&lt;user&gt;:&lt;group&gt;<span class="o">]</span> &lt;源路径1&gt;...  &lt;目标路径&gt;<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    COPY <span class="o">[</span>--chown<span class="o">=</span>&lt;user&gt;:&lt;group&gt;<span class="o">]</span> <span class="o">[</span><span class="s2">&#34;&lt;源路径1&gt;&#34;</span>,...  <span class="s2">&#34;&lt;目标路径&gt;&#34;</span><span class="o">]</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>&lt;源路径&gt;：源文件或者源目录，这里可以是通配符表达式，其通配符规则要满足 Go 的 filepath.Match 规则。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">    COPY hom* /mydir/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    COPY hom?.txt /mydir/<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="from">FROM</h3>
<p>FROM：定制的镜像都是基于 FROM 的镜像</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">    FROM nginx<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="run">RUN</h3>
<p>RUN：用于执行后面跟着的命令行命令</p>
<p>shell：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">    RUN &lt;命令行命令&gt;<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    <span class="c1"># &lt;命令行命令&gt; 等同于，在终端操作的 shell 命令。</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>exec：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">    RUN <span class="o">[</span><span class="s2">&#34;可执行文件&#34;</span>, <span class="s2">&#34;参数1&#34;</span>, <span class="s2">&#34;参数2&#34;</span><span class="o">]</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    <span class="c1"># 例如：</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    <span class="c1"># RUN [&#34;./test.php&#34;, &#34;dev&#34;, &#34;offline&#34;] 等价于 RUN ./test.php dev offline</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="add">ADD</h3>
<p>ADD 指令和 COPY 的使用格类似</p>
<p>ADD 的优点：在执行 &lt;源文件&gt; 为 tar 压缩文件的话，压缩格式为 gzip, bzip2 以及 xz 的情况下，会自动复制并解压到 &lt;目标路径&gt;。</p>
<p>ADD 的缺点：在不解压的前提下，无法复制 tar 压缩文件。会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。具体是否使用，可以根据是否需要自动解压来决定。</p>
<h3 id="cmd">CMD</h3>
<p>类似于 RUN 指令，用于运行程序，但二者运行的时间点不同:</p>
<ol>
<li>CMD 在 docker run 时运行。</li>
<li>RUN 是在 docker build。</li>
</ol>
<p>Dockerfile 中如果存在多个 CMD 指令，仅最后一个生效。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">    CMD &lt;shell 命令&gt;<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    CMD <span class="o">[</span><span class="s2">&#34;&lt;可执行文件或命令&gt;&#34;</span>,<span class="s2">&#34;&lt;param1&gt;&#34;</span>,<span class="s2">&#34;&lt;param2&gt;&#34;</span>,...<span class="o">]</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    CMD <span class="o">[</span><span class="s2">&#34;&lt;param1&gt;&#34;</span>,<span class="s2">&#34;&lt;param2&gt;&#34;</span>,...<span class="o">]</span>  <span class="c1"># 该写法是为 ENTRYPOINT 指令指定的程序提供默认参数</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="通过-dockerfile-文件封装-hugo">通过 dockerfile 文件封装 hugo</h2>
<p>dokcerfile 文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl">    FROM nginx:1.21<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    COPY public/ /usr/share/nginx/html<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>docker.sh 文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">    <span class="c1">#/!bin/bash</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;删除旧的docker&#34;</span>
</span></span><span class="line"><span class="cl">    docker ps
</span></span><span class="line"><span class="cl">    docker stop nginx-hugo
</span></span><span class="line"><span class="cl">    docker rm nginx-hugo
</span></span><span class="line"><span class="cl">    docker rmi nginx:hugo
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;生成新的docker&#34;</span>
</span></span><span class="line"><span class="cl">    hugo -t LoveIt -D
</span></span><span class="line"><span class="cl">    docker build -t nginx:hugo .
</span></span><span class="line"><span class="cl">    docker run --name nginx-hugo -d -p 8080:80 nginx:hugo
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;显示端口&#34;</span>
</span></span><span class="line"><span class="cl">    netstat -lntp
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行脚本：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">    sh update.sh
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description>
</item></channel>
</rss>
